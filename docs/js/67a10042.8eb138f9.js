(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["67a10042"],{"3c32":function(t,e,a){"use strict";var i=a("f8c5"),o=a.n(i);o.a},b859:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"q-pa-md"},[a("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[a("q-btn",{attrs:{fab:"",icon:"add",color:"accent"},on:{click:t.showTaskCreateDialog}})],1),a("q-table",{attrs:{title:"Tasks",loading:t.table.loading,data:t.data,columns:t.columns,"row-key":"id",pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e},request:t.getTableData},scopedSlots:t._u([{key:"body",fn:function(e){return[a("q-tr",{attrs:{props:e}},[a("q-td",{key:"id",attrs:{"auto-width":"",props:e}},[t._v(t._s(e.row.id))]),a("q-td",{key:"title",attrs:{"auto-width":"",props:e}},[t._v(t._s(e.row.title))]),a("q-td",{key:"description",attrs:{"auto-width":"",props:e}},[t._v(t._s(e.row.description))]),a("q-td",{key:"total_spent_minute",attrs:{"auto-width":"",props:e}},[t._v(t._s(t._f("minutes2readable")(e.row.total_spent_minute)))]),a("q-td",{key:"create_time",attrs:{"auto-width":"",props:e}},[t._v(t._s(e.row.create_time))]),a("q-td",{key:"operation",attrs:{"auto-width":"",props:e}},[a("q-btn",{staticClass:"row-btn",attrs:{round:"",color:"primary",icon:"av_timer",size:"sm"},on:{click:function(a){return t.showTimeTrackDialog(e.row)}}})],1)],1)]}}])}),a("q-dialog",{model:{value:t.dialog.create.show,callback:function(e){t.$set(t.dialog.create,"show",e)},expression:"dialog.create.show"}},[a("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("Create a task")])]),a("q-card-section",[a("q-form",{ref:"form.create",on:{submit:t.onCreate}},[a("em",{staticClass:"form-label"},[t._v("Title *")]),a("q-input",{attrs:{outlined:"","lazy-rules":"",rules:[function(t){return t&&t.length>0||"Title is required"}]},model:{value:t.dialog.create.model.title,callback:function(e){t.$set(t.dialog.create.model,"title",e)},expression:"dialog.create.model.title"}}),a("em",{staticClass:"form-label"},[t._v("Description (optional)")]),a("q-editor",{attrs:{"min-height":"5rem","max-height":"15rem"},model:{value:t.dialog.create.model.description,callback:function(e){t.$set(t.dialog.create.model,"description",e)},expression:"dialog.create.model.description"}})],1)],1),a("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary",label:"Create"},on:{click:t.onCreate}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Close"}})],1)],1)],1),a("q-dialog",{model:{value:t.dialog.track.show,callback:function(e){t.$set(t.dialog.track,"show",e)},expression:"dialog.track.show"}},[a("q-card",{staticStyle:{width:"700px","max-width":"80vw"}},[a("q-card-section",[a("div",{staticClass:"text-h6"},[t._v("Time tracking on task: "+t._s(t.dialog.track.info.task.title))])]),a("q-card-section",[a("q-form",{ref:"form.track",on:{submit:t.onTrack}},[a("em",{staticClass:"form-label"},[t._v("Date *")]),a("q-input",{attrs:{outlined:"",mask:"date",rules:["date"]},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[a("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[a("q-date",{on:{input:function(){return t.$refs.qDateProxy.hide()}},model:{value:t.dialog.track.model.dateStr,callback:function(e){t.$set(t.dialog.track.model,"dateStr",e)},expression:"dialog.track.model.dateStr"}})],1)],1)]},proxy:!0}]),model:{value:t.dialog.track.model.dateStr,callback:function(e){t.$set(t.dialog.track.model,"dateStr",e)},expression:"dialog.track.model.dateStr"}}),a("em",{staticClass:"form-label"},[t._v("Time *")]),a("q-input",{attrs:{outlined:"","lazy-rules":"",rules:t.dialog.track.rule.timeExression},model:{value:t.dialog.track.model.timeExression,callback:function(e){t.$set(t.dialog.track.model,"timeExression",e)},expression:"dialog.track.model.timeExression"}}),a("em",{staticClass:"form-label"},[t._v("Description (optional)")]),a("q-editor",{attrs:{"min-height":"5rem","max-height":"15rem"},model:{value:t.dialog.create.model.description,callback:function(e){t.$set(t.dialog.create.model,"description",e)},expression:"dialog.create.model.description"}})],1)],1),a("q-card-actions",{staticClass:"bg-white text-teal",attrs:{align:"right"}},[a("q-btn",{attrs:{color:"primary",label:"Track"},on:{click:t.onTrack}}),a("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Close"}})],1)],1)],1)],1)},o=[],r=(a("551c"),a("5df3"),a("ac6a"),a("cadf"),a("06db"),a("28a5"),a("c5f6"),a("3b2b"),a("b34e"));function n(){var t=new Date;return"".concat(t.getFullYear(),"/").concat(t.getMonth()+1,"/").concat(t.getDate())}var s={name:"task",data:function(){return{dialog:{create:{show:!1,model:{title:null,description:""}},track:{show:!1,info:{task:{id:null,title:"",description:"",create_time:null}},model:{dateStr:"",timeExression:null,description:""},rule:{timeExression:[function(t){var e=!1;if(t&&t.length>0){var a=new RegExp(/^([\d]{1,2}[h]|[\d]{1,2}[m]|[\d]{1,2}[h][\d]{1,2}[m])$/,"i");a.test(t)&&(e=!0)}return!!e||"30m - 30 Minitues; 1h - 1 Hour; 1h30m - 1 Hour 30 Minutes."}]}}},data:[],columns:[{name:"id",label:"ID",required:!0,field:"id",sortable:!0,align:"left"},{name:"title",label:"Title",required:!0,field:"title",align:"left"},{name:"description",label:"Description",required:!0,field:"description",align:"left"},{name:"total_spent_minute",label:"Total spent",required:!0,field:"total_spent_minute",align:"left"},{name:"create_time",label:"Create time",required:!0,align:"left",field:function(t){return""+t.create_time}},{name:"operation",label:"Operation",required:!0,align:"left"}],pagination:{sortBy:"id",descending:!0,page:1,rowsPerPage:3,rowsNumber:0},table:{loading:!0}}},filters:{minutes2readable:function(t){return t<=0?"0h0m":"".concat(parseInt(t/60),"h").concat(t%60,"m")}},methods:{parseMinitues:function(t){var e=t.toLowerCase(),a=0;if(e.indexOf("h")>0&&e.indexOf("m")<0)a=60*Number(e.split("h")[0]);else if(e.indexOf("h")<0&&e.indexOf("m")>0)a=Number(e.split("m")[0]);else{var i=e.substring(0,e.indexOf("h")),o=e.substring(e.indexOf("h")+1,e.indexOf("m"));a=60*Number(i)+Number(o)}return a},onTrack:function(){var t=this;this.$refs["form.track"].validate().then((function(e){if(e){var a=t.parseMinitues(t.dialog.track.model.timeExression),i=t.$db.getSchema().table("task"),o=t.$db.getSchema().table("activity"),r=t.$db.getSchema().table("spent_time_item"),n=t.$db.createTransaction();n.begin([i,o,r]).then((function(){var e=t.$db.update(i).set(i.total_spent_minute,t.dialog.track.info.task.total_spent_minute+a).where(i.id.eq(t.dialog.track.info.task.id));return n.attach(e)})).then((function(e){var i=r.createRow({task_id:t.dialog.track.info.task.id,description:t.dialog.track.model.description,create_time:new Date,spent_minute:a}),o=t.$db.insertOrReplace().into(r).values([i]);return n.attach(o)})).then((function(e){var a=o.createRow({type:101,title:"Spent time on task",subtitle:"Sepnt ".concat(t.dialog.track.model.timeExression," on task: ").concat(t.dialog.track.info.task.title,"."),body:t.dialog.track.model.description,create_time:new Date}),i=t.$db.insertOrReplace().into(o).values([a]);return n.attach(i)})).then((function(){return n.commit()})).then((function(){t.$q.notify({color:"green",message:"Success!"}),t.dialog.track.model.dateStr=null,t.dialog.track.model.timeExression="",t.getTableData(),t.dialog.track.show=!1})).catch((function(e){t.$q.notify({color:"red",message:"Create failed, detailed message: "+JSON.stringify(e)})}))}}))},showTimeTrackDialog:function(t){this.dialog.track.model.dateStr=n(),this.dialog.track.info.task=t,this.dialog.track.show=!0},showTaskCreateDialog:function(){this.dialog.create.show=!this.dialog.create.show},onCreate:function(){var t=this;this.$refs["form.create"].validate().then((function(e){if(e){var a=t.$db.getSchema().table("task"),i=t.$db.getSchema().table("activity"),o=t.$db.createTransaction();o.begin([a,i]).then((function(){var e=a.createRow({title:t.dialog.create.model.title,description:t.dialog.create.model.description,total_spent_minute:0,create_time:new Date}),i=t.$db.insertOrReplace().into(a).values([e]);return o.attach(i)})).then((function(e){var a=i.createRow({type:100,title:"Create a task",subtitle:t.dialog.create.model.title,body:t.dialog.create.model.description,create_time:new Date}),r=t.$db.insertOrReplace().into(i).values([a]);return o.attach(r)})).then((function(){return o.commit()})).then((function(){t.$q.notify({color:"green",message:"Success!"}),t.dialog.create.model.title=null,t.dialog.create.model.description="",t.getTableData(),t.dialog.create.show=!1})).catch((function(e){t.$q.notify({color:"red",message:"Create failed, detailed message: "+JSON.stringify(e)})}))}})).catch((function(e){t.$q.notify("Invalid!"+e)}))},getTableData:function(t){var e=this;t&&t.pagination&&(this.pagination=t.pagination),this.table.loading=!0;var a=this.$db.getSchema().table("task");Promise.all([this.$db.select(r["fn"].count(a.id)).from(a).exec(),this.$db.select().from(a).orderBy(a.id,r["Order"].DESC).skip((this.pagination.page-1)*this.pagination.rowsPerPage).limit(this.pagination.rowsPerPage).exec()]).then((function(t){var a=t[0],i=t[1];e.pagination.rowsNumber=a[0]["COUNT(id)"],e.data=i,e.table.loading=!1})).catch((function(t){e.$q.notify({message:"Error get tasks, detailed error message: "+JSON.stringify(t),color:"red"})}))}},mounted:function(){this.getTableData()}},l=s,c=(a("3c32"),a("2877")),d=a("de5e"),m=a("9c40"),u=a("eaac"),p=a("bd08"),g=a("db86"),f=a("24e8"),h=a("f09f"),b=a("a370"),k=a("0378"),w=a("27f9"),v=a("d66b"),q=a("4b7e"),_=a("0016"),x=a("7cbe"),y=a("52ee"),$=a("7f67"),C=Object(c["a"])(l,i,o,!1,null,null,null);e["default"]=C.exports;C.options.components=Object.assign({QPageSticky:d["a"],QBtn:m["a"],QTable:u["a"],QTr:p["a"],QTd:g["a"],QDialog:f["a"],QCard:h["a"],QCardSection:b["a"],QForm:k["a"],QInput:w["a"],QEditor:v["a"],QCardActions:q["a"],QIcon:_["a"],QPopupProxy:x["a"],QDate:y["a"]},C.options.components),C.options.directives=Object.assign({ClosePopup:$["a"]},C.options.directives)},f8c5:function(t,e,a){}}]);